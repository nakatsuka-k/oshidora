# プロフィール登録画面 設計書

---

## 画面名

* 画面ID：APP-00051（ユーザプロフィール登録）

  * ※機能一覧上は「マイページ > ユーザプロフィール」配下だが、新規会員登録（APP-00004）完了後に初回登録として同UIを流用する想定 
* 画面名：プロフィール登録
* 目的：利用開始前に、ユーザーの基本プロフィール情報を登録する
* 遷移元：

  * 新規会員登録（APP-00004：メール2段階認証＋SMS認証）完了直後 
* 遷移先：

  * プロフィール登録完了（APP-00053：完了） 
  * （戻る導線を置く場合）ログイン／登録導線へ戻すのではなく、登録フローを継続させる（途中離脱を防ぐ）

---

## 画面概要

* 入力項目

  * 表示名（ニックネーム）
  * プロフィール画像
  * メールアドレス
  * パスワード
  * 電話番号
  * 生年月日 
* 新規会員登録で使用したメールアドレス・電話番号は、初期表示で引き継ぐ（編集可否は下記仕様）
* 登録後はアプリ利用を開始できる状態にする（トップへ遷移などは別途フロー側で統一）

---

## 画面キャプチャ / ワイヤー

* 画面遷移図「プロフィール登録」ノードを参照（添付画像）
* 本画面はフォーム中心（スクロール可能）

---

## 操作概要

* 表示名を入力
* プロフィール画像を選択（端末からアップロード）
* メールアドレスを確認・必要なら編集
* パスワードを設定（確認入力あり）
* 電話番号を確認（SMS認証済み番号を表示）
* 生年月日を選択
* 「登録」押下で保存し、完了画面へ

---

## 詳細テーブル

| 部品名称      | 部品の種類     | 型   | 桁数  | IN | OUT | 初期値                              | 表示仕様                            | エラーNo     | DB情報備考                 | テーブル名 | カラム名          |
| :-------- | :-------- | :-- | :-- | :- | :-- | :------------------------------- | :------------------------------ | :-------- | :--------------------- | :---- | :------------ |
| 画面タイトル    | 見出し       | 文字列 | 20  |    | ○   | `プロフィール登録`                       | 画面上部に表示                         |           |                        |       |               |
| 説明文       | テキスト      | 文字列 | 120 |    | ○   | `あと少しで利用開始できます。プロフィールを登録してください。` | タイトル下に表示                        |           |                        |       |               |
| 表示名       | テキスト入力    | 文字列 | 20  | ○  |     | 空                                | プレースホルダー例：`推しドラ太郎`。絵文字は可/不可を要決定 | E-PRF-001 | 前後トリム。重複可              | users | display_name  |
| プロフィール画像  | 画像アップロード  | 画像  | -   | ○  | ○   | 未設定                              | サムネ表示＋「変更」ボタン。未設定時はプレースホルダー     | E-PRF-002 | 端末画像→アップロード→URL保存      | users | avatar_url    |
| メールアドレス   | テキスト入力    | メール | 254 | ○  |     | 登録フロー入力値                         | 初期値表示。編集可（編集した場合は再認証要否を要決定）     | E-PRF-003 | 正規化（小文字化）。重複不可         | users | email         |
| パスワード     | パスワード入力   | 文字列 | 64  | ○  |     | 空                                | 伏字。表示切替アイコンあり                   | E-PRF-004 | ハッシュ保存                 | users | password_hash |
| パスワード（確認） | パスワード入力   | 文字列 | 64  | ○  |     | 空                                | 伏字。一致チェック                       | E-PRF-005 | 検証のみ保持                 | -     | -             |
| 電話番号      | テキスト表示/入力 | 文字列 | 20  | ○  |     | SMS認証済み番号                        | SMS認証済みとして表示。編集不可（変更は別フロー）      | E-PRF-006 | E.164形式で保存推奨           | users | phone_number  |
| 生年月日      | 日付入力      | 日付  | -   | ○  |     | 未設定                              | DatePicker。年/月/日選択              | E-PRF-007 | 年齢判定に使う場合は0:00基準       | users | birthday      |
| 登録ボタン     | ボタン       | -   | -   | ○  |     | 非活性                              | 入力が成立すると活性化。押下で保存               | E-PRF-999 | POST `/api/profile` 相当 | -     | -             |
| スキップ      | テキストボタン   | -   | -   | ○  |     | 表示する/しない                         | 初期は非表示推奨（後でマイページ編集可能）           |           |                        |       |               |

---

## 挙動仕様

### 入力チェック

* 表示名

  * 文字数上限、使用禁止文字（改行・制御文字など）
* プロフィール画像

  * 容量上限（例：5MB）、形式（jpg/png/heic）
* メールアドレス

  * 形式チェック、既存アカウントとの重複チェック
  * 初回登録で引き継いだ値を編集できる場合：編集後に再認証が必要かは要決定（運用的には「編集不可」に寄せると安全）
* パスワード

  * 最小文字数（例：8以上）、英数字混在など（要件に合わせる）
* 電話番号

  * SMS認証で確定した番号を表示。変更は本画面では行わない（変更するなら別のSMS再認証フロー）
* 生年月日

  * 未来日不可
  * 年齢制限がある場合はここで判定（例：年齢制限コンテンツの可否など）

### 登録ボタン

* 押下で保存処理開始 → ローディング表示 → 成功で完了画面へ
* 通信失敗時：画面上部にエラーメッセージ、入力内容は保持

---

## 画面メッセージ（例）

* 画像アップロード失敗：`画像のアップロードに失敗しました。通信状況を確認して再度お試しください。`
* メール形式不正：`メールアドレスの形式が正しくありません。`
* パスワード不一致：`パスワードが一致しません。`
* 生年月日不正：`生年月日を正しく選択してください。`

---

## 備考

* ユーザプロフィールの項目は機能一覧に記載のとおり（表示名／プロフィール画像／メール／パスワード／電話番号／生年月日）。 
* 新規会員登録（APP-00004）内で「登録時にユーザプロフィールを登録」とあるため、この画面は登録フローの一部として扱う。 
* マイページ側の「編集」「完了」（APP-00052/53）は、初回登録と同じフォームを流用しても良い。 
