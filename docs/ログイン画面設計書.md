# ログイン／パスワード再設定 画面設計書

本資料は [docs/20260109全体画面仕様.md](docs/20260109全体画面仕様.md)（APP-00013〜APP-00018）を正とし、ログインおよびパスワード再設定の仕様をまとめる。

---

## 全体画面仕様準拠（20260109）

### APP-00013 ログイン

* 目的：メール＋パスワードでログインを開始
* 遷移：会員登録/ログイン選択（APP-00003）→ メールアドレス認証（ログイン用）（APP-00014）
* 入力：メールアドレス、パスワード
* 補足：パスワード再設定導線（任意）→ APP-00015

### APP-00014 メールアドレス認証画面（ログイン）

* 目的：認証コード（6桁）でログインを完了
* 遷移：APP-00013 → トップ（APP-00019）
* 入力：認証コード（6桁）
* 補足：再発行は要件確定（全体画面仕様に「再発行あり」）

### APP-00015〜APP-00018 パスワード再設定

* APP-00015：再設定メールアドレス入力（入力：メール）→ APP-00016

  * 備考：一致/不一致に関わらず認証画面へ遷移
* APP-00016：再設定メール認証（入力：認証コード6桁）→ APP-00017
* APP-00017：パスワード再設定（入力：PW/PW再入力）→ APP-00018

  * 備考：バリデーションは新規登録（APP-00007）と同様
* APP-00018：再設定完了 → ログイン（APP-00013）

---

## 参考：旧仕様（SMS 2段階認証案）

※以下は過去の検討内容（AXCMS-* 採番）として残す。全体画面仕様（20260109）に含まれていないため、ログイン要件として採用する場合は APP-00013〜 の仕様へ統合して再整理する。

---

## 画面名（AXCMS-L-001）

* 画面ID: AXCMS-L-001
* 目的: 既存ユーザーがメールアドレス・パスワードで認証を開始し、SMS を用いた2段階認証へ進む。
* 遷移元: アプリ起動時 / 未ログイン状態からの保護画面遷移
* 遷移先: 電話番号入力（AXCMS-L-002）、（キャンセル時）アプリ前画面/起動元へ戻る

---

## 画面概要（必須）（AXCMS-L-001）

* 概要: 利用規約同意を前提としたログインフォーム。メールアドレス・パスワード入力後に次画面でSMS認証に進む。
* 主な利用者: 既存ユーザー（ログイン対象者）

---

## 操作概要（AXCMS-L-001）

* メールアドレス：半角英数字＋記号入力（メール形式）
* パスワード：伏字入力
* 「次へ」押下で入力チェック後、電話番号入力（AXCMS-L-002）へ遷移
* 「キャンセル」押下でログインを中断し、起動元へ戻る

---

## 詳細テーブル（AXCMS-L-001）

* 画面タイトル：`会員登録` / `ログイン`（表示文言は要件に合わせる）
* 入力：メールアドレス（必須、形式チェック、前後トリム）
* 入力：パスワード（必須、伏字表示。ログインでは強度チェック不要）
* 次へ：必須項目OKで活性。認証開始API（例：`POST /api/auth/login`）成功で AXCMS-L-002 へ
* キャンセル：起動元へ戻る（ログイン状態は変更しない）
* エラー表示：入力エラーは項目下、認証失敗はバナー表示（例：メール/パスワード不一致）

---

## 挙動仕様（AXCMS-L-001）

* 入力必須項目: メールアドレス、パスワード
* バリデーション:

  * メールアドレス: 形式チェック、前後スペース除去
  * パスワード: 未入力チェック（詳細な強度チェックはログインでは不要。登録/変更時に実施）
* エラー表示:

  * 入力エラーは該当項目下に表示し、入力欄を強調
  * 認証失敗（メール/パスワード不一致）は画面上部バナーで表示（例:「メールアドレスまたはパスワードが正しくありません」）
* ボタン挙動:

  * 必須2項目が有効なときのみ「次へ」押下可能
  * 「次へ」押下 → 認証開始API成功時、電話番号入力（AXCMS-L-002）へ遷移
  * 「キャンセル」押下 → 中断して起動元へ戻る（ログイン状態は変更しない）

---

---

## 電話番号入力（SMS認証）画面設計書（AXCMS-L-002）

---

## 画面名（AXCMS-L-002）

* 画面ID: AXCMS-L-002
* 目的: SMS送信先の電話番号を入力し、認証コード送信を行う。
* 遷移元: ログイン（AXCMS-L-001）
* 遷移先: 2段階認証コード入力（AXCMS-L-003）、（キャンセル時）ログイン（AXCMS-L-001）

---

## 画面概要（必須）（AXCMS-L-002）

* 概要: 電話番号入力フォーム。送信後、認証コード入力画面へ進む。
* 主な利用者: 既存ユーザー

---

## 操作概要（AXCMS-L-002）

* 電話番号：半角数字（ハイフン任意/禁止は要件に合わせて統一）
* 「次へ」押下でSMS送信 → 成功時に認証コード入力（AXCMS-L-003）へ遷移
* 「キャンセル」押下でログイン（AXCMS-L-001）へ戻る（ログイン途中状態は破棄）

---

## 詳細テーブル（AXCMS-L-002）

* 画面タイトル：`SMS認証`
* 入力：電話番号（必須、数字のみ。ハイフン許容は要件確定）
* 送信：必要に応じて E.164 に正規化して送信
* 次へ：入力OKで活性。SMS送信API（例：`POST /api/auth/sms/send`）成功で AXCMS-L-003 へ
* キャンセル：AXCMS-L-001 へ戻る（入力値は破棄）
* エラー表示：送信失敗などはバナー/項目下に表示

---

## 挙動仕様（AXCMS-L-002）

* 入力必須項目: 電話番号
* バリデーション:

  * 数字のみ（ハイフンを許容する場合は送信前に除去）
  * 桁数チェック（国内想定なら 10〜11 桁など、要件に合わせる）
* 送信処理:

  * 「次へ」押下でSMS送信APIを実行
  * 送信成功 → AXCMS-L-003へ遷移
  * 送信失敗 → エラーバナー表示（例:「SMSの送信に失敗しました。時間をおいて再度お試しください。」）
* キャンセル:

  * AXCMS-L-001へ戻る（入力値は破棄）

---

---

## 2段階認証（認証コード入力）画面設計書（AXCMS-L-003）

---

## 画面名（AXCMS-L-003）

* 画面ID: AXCMS-L-003
* 目的: SMSで受け取った認証コードを入力し、ログインを完了する。
* 遷移元: 電話番号入力（AXCMS-L-002）
* 遷移先: トップ（AXCMS-T-001）※ログイン後にトップページへ遷移すること、（キャンセル時）ログイン（AXCMS-L-001）

---

## 画面概要（必須）（AXCMS-L-003）

* 概要: 認証コード（ワンタイムコード）を桁分割UIで入力する。検証に成功したらログイン完了とする。
* 主な利用者: 既存ユーザー

---

## 操作概要（AXCMS-L-003）

* 認証コード：数字4〜6桁（要件に合わせて統一）。桁ごとの入力欄に入力。
* 「次へ」押下でコード検証 → 成功時にトップ（AXCMS-T-001）へ遷移
* 「キャンセル」押下でログイン（AXCMS-L-001）へ戻る（ログイン途中状態は破棄）

---

## 詳細テーブル（AXCMS-L-003）

* 画面タイトル：`2段階認証`
* 説明：`電話番号(SMS)に送信された認証コードを入力して下さい`
* 入力：認証コード（数字4〜6桁。桁分割UIで入力）
* 次へ：全桁入力で活性。検証API（例：`POST /api/auth/sms/verify`）成功でトップへ
* キャンセル：AXCMS-L-001 へ戻る（ログイン途中状態は破棄）
* エラー表示：コード不一致などを表示（入力欄クリア有無は要件確定）

---

## 挙動仕様（AXCMS-L-003）

* 入力必須項目: 認証コード
* バリデーション:

  * 数字のみ、指定桁数（例: 4桁 or 6桁）に一致すること
* 検証処理:

  * 「次へ」押下 → 認証コード検証API
  * 成功 → **トップ（AXCMS-T-001）へ遷移**（ログイン状態確立、トークン/セッション保存）
  * 失敗 → エラー表示（例:「認証コードが正しくありません」）。入力欄をクリア or 維持は要件で統一
* キャンセル:

  * ログイン（AXCMS-L-001）へ戻る（セッション未確立のためログイン状態は変えない）

---

## 備考（ログイン一連共通）

* 連続失敗回数が一定を超えた場合は、一定時間ロック/再送制限などのセキュリティ要件を別途定義する。
* SMS再送ボタンを追加する場合は、AXCMS-L-003に「再送」部品・クールダウン表示（秒数）・再送APIを追記する。
* トップページ画面ID（例）: AXCMS-T-001（既存のトップ設計書がある場合はそちらのIDに合わせる）。
