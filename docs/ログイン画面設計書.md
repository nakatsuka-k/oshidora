# ログイン（SMS 2段階認証）画面設計書

---

## 画面名

* 画面ID: AXCMS-L-001
* 目的: 既存ユーザーがメールアドレス・パスワードで認証を開始し、SMS を用いた2段階認証へ進む。
* 遷移元: アプリ起動時 / 未ログイン状態からの保護画面遷移
* 遷移先: 電話番号入力（AXCMS-L-002）、（キャンセル時）アプリ前画面/起動元へ戻る

---

## 画面概要（必須）

* 概要: 利用規約同意を前提としたログインフォーム。メールアドレス・パスワード入力後に次画面でSMS認証に進む。
* 主な利用者: 既存ユーザー（ログイン対象者）

---

## 操作概要

* メールアドレス：半角英数字＋記号入力（メール形式）
* パスワード：伏字入力
* 「次へ」押下で入力チェック後、電話番号入力（AXCMS-L-002）へ遷移
* 「キャンセル」押下でログインを中断し、起動元へ戻る

---

## 詳細テーブル（AXCMS-L-001）

| 部品名称           | 部品の種類      | 型   | 桁数  | IN | OUT | 必須 | 初期値                           | 表示仕様                 | エラーNo    | DB情報備考                    | テーブル名 | カラム名  |
| :------------- | :--------- | :-- | :-- | :- | :-- | :- | :---------------------------- | :------------------- | :------- | :------------------------ | :---- | :---- |
| 画面タイトル         | 見出し        | 文字列 | 24  |    | ○   |    | `会員登録` / `ログイン`（表示文言は要件に合わせる） | 上部中央                 |          | 固定表示                      |       |       |
| セクション: メールアドレス | テキストフィールド  | メール | 254 | ○  |     | 必須 | 空文字                           | プレースホルダー「メールアドレス」    | L-001-01 | トリムして送信                   | users | email |
| セクション: パスワード   | パスワードフィールド | 文字列 | 128 | ○  |     | 必須 | 空文字                           | 伏字表示、プレースホルダー「パスワード」 | L-001-02 | 送信のみ（保持しない）               |       |       |
| 次へボタン          | ボタン（プライマリ） | -   | -   | ○  |     | 必須 | 非活性（初期）                       | 必須項目OKで活性            |          | POST `/api/auth/login`（仮） |       |       |
| キャンセルボタン       | ボタン（セカンダリ） | -   | -   | ○  |     |    | -                             | 画面下部                 |          | 起動元へ戻る                    |       |       |
| エラーメッセージ領域     | バナー/テキスト   | 文字列 | 200 |    | ○   |    | 非表示                           | 画面上部 or 項目下に表示       | L-001-XX | 表示のみ                      |       |       |

---

## 挙動仕様（AXCMS-L-001）

* 入力必須項目: メールアドレス、パスワード
* バリデーション:

  * メールアドレス: 形式チェック、前後スペース除去
  * パスワード: 未入力チェック（詳細な強度チェックはログインでは不要。登録/変更時に実施）
* エラー表示:

  * 入力エラーは該当項目下に表示し、入力欄を強調
  * 認証失敗（メール/パスワード不一致）は画面上部バナーで表示（例:「メールアドレスまたはパスワードが正しくありません」）
* ボタン挙動:

  * 必須2項目が有効なときのみ「次へ」押下可能
  * 「次へ」押下 → 認証開始API成功時、電話番号入力（AXCMS-L-002）へ遷移
  * 「キャンセル」押下 → 中断して起動元へ戻る（ログイン状態は変更しない）

---

---

# 電話番号入力（SMS認証）画面設計書

---

## 画面名

* 画面ID: AXCMS-L-002
* 目的: SMS送信先の電話番号を入力し、認証コード送信を行う。
* 遷移元: ログイン（AXCMS-L-001）
* 遷移先: 2段階認証コード入力（AXCMS-L-003）、（キャンセル時）ログイン（AXCMS-L-001）

---

## 画面概要（必須）

* 概要: 電話番号入力フォーム。送信後、認証コード入力画面へ進む。
* 主な利用者: 既存ユーザー

---

## 操作概要

* 電話番号：半角数字（ハイフン任意/禁止は要件に合わせて統一）
* 「次へ」押下でSMS送信 → 成功時に認証コード入力（AXCMS-L-003）へ遷移
* 「キャンセル」押下でログイン（AXCMS-L-001）へ戻る（ログイン途中状態は破棄）

---

## 詳細テーブル（AXCMS-L-002）

| 部品名称        | 部品の種類      | 型   | 桁数  | IN | OUT | 必須 | 初期値     | 表示仕様           | エラーNo    | DB情報備考                       | テーブル名 | カラム名  |
| :---------- | :--------- | :-- | :-- | :- | :-- | :- | :------ | :------------- | :------- | :--------------------------- | :---- | :---- |
| 画面タイトル      | 見出し        | 文字列 | 24  |    | ○   |    | `SMS認証` | 上部中央           |          | 固定表示                         |       |       |
| フィールド: 電話番号 | テキストフィールド  | 文字列 | 20  | ○  |     | 必須 | 空文字     | プレースホルダー「電話番号」 | L-002-01 | E.164に正規化して送信推奨              | users | phone |
| 次へボタン       | ボタン（プライマリ） | -   | -   | ○  |     | 必須 | 非活性（初期） | 入力OKで活性        |          | POST `/api/auth/sms/send`（仮） |       |       |
| キャンセルボタン    | ボタン（セカンダリ） | -   | -   | ○  |     |    | -       | 下部             |          | AXCMS-L-001へ戻る               |       |       |
| エラーメッセージ領域  | バナー/テキスト   | 文字列 | 200 |    | ○   |    | 非表示     | 上部 or 項目下      | L-002-XX | 表示のみ                         |       |       |

---

## 挙動仕様（AXCMS-L-002）

* 入力必須項目: 電話番号
* バリデーション:

  * 数字のみ（ハイフンを許容する場合は送信前に除去）
  * 桁数チェック（国内想定なら 10〜11 桁など、要件に合わせる）
* 送信処理:

  * 「次へ」押下でSMS送信APIを実行
  * 送信成功 → AXCMS-L-003へ遷移
  * 送信失敗 → エラーバナー表示（例:「SMSの送信に失敗しました。時間をおいて再度お試しください。」）
* キャンセル:

  * AXCMS-L-001へ戻る（入力値は破棄）

---

---

# 2段階認証（認証コード入力）画面設計書

---

## 画面名

* 画面ID: AXCMS-L-003
* 目的: SMSで受け取った認証コードを入力し、ログインを完了する。
* 遷移元: 電話番号入力（AXCMS-L-002）
* 遷移先: トップ（AXCMS-T-001）※ログイン後にトップページへ遷移すること、（キャンセル時）ログイン（AXCMS-L-001）

---

## 画面概要（必須）

* 概要: 認証コード（ワンタイムコード）を桁分割UIで入力する。検証に成功したらログイン完了とする。
* 主な利用者: 既存ユーザー

---

## 操作概要

* 認証コード：数字4〜6桁（要件に合わせて統一）。桁ごとの入力欄に入力。
* 「次へ」押下でコード検証 → 成功時にトップ（AXCMS-T-001）へ遷移
* 「キャンセル」押下でログイン（AXCMS-L-001）へ戻る（ログイン途中状態は破棄）

---

## 詳細テーブル（AXCMS-L-003）

| 部品名称       | 部品の種類      | 型     | 桁数  | IN | OUT | 必須 | 初期値                            | 表示仕様                      | エラーNo    | DB情報備考                         | テーブル名 | カラム名 |
| :--------- | :--------- | :---- | :-- | :- | :-- | :- | :----------------------------- | :------------------------ | :------- | :----------------------------- | :---- | :--- |
| 画面タイトル     | 見出し        | 文字列   | 24  |    | ○   |    | `2段階認証`                        | 上部中央                      |          | 固定表示                           |       |      |
| 説明テキスト     | ラベル        | 文字列   | 80  |    | ○   |    | `電話番号(SMS)に送信された認証コードを入力して下さい` | 中央寄せ                      |          | 固定表示                           |       |      |
| 認証コード入力    | PIN入力      | 数値文字列 | 6   | ○  |     | 必須 | 空文字                            | 4〜6枠の分割入力。入力に応じて自動フォーカス移動 | L-003-01 | 検証のみ保持                         |       |      |
| 次へボタン      | ボタン（プライマリ） | -     | -   | ○  |     | 必須 | 非活性（初期）                        | 全桁入力で活性                   |          | POST `/api/auth/sms/verify`（仮） |       |      |
| キャンセルボタン   | ボタン（セカンダリ） | -     | -   | ○  |     |    | -                              | 下部                        |          | AXCMS-L-001へ戻る                 |       |      |
| エラーメッセージ領域 | バナー/テキスト   | 文字列   | 200 |    | ○   |    | 非表示                            | 上部 or 入力欄下                | L-003-XX | 表示のみ                           |       |      |

---

## 挙動仕様（AXCMS-L-003）

* 入力必須項目: 認証コード
* バリデーション:

  * 数字のみ、指定桁数（例: 4桁 or 6桁）に一致すること
* 検証処理:

  * 「次へ」押下 → 認証コード検証API
  * 成功 → **トップ（AXCMS-T-001）へ遷移**（ログイン状態確立、トークン/セッション保存）
  * 失敗 → エラー表示（例:「認証コードが正しくありません」）。入力欄をクリア or 維持は要件で統一
* キャンセル:

  * ログイン（AXCMS-L-001）へ戻る（セッション未確立のためログイン状態は変えない）

---

## 備考（ログイン一連共通）

* 連続失敗回数が一定を超えた場合は、一定時間ロック/再送制限などのセキュリティ要件を別途定義する。
* SMS再送ボタンを追加する場合は、AXCMS-L-003に「再送」部品・クールダウン表示（秒数）・再送APIを追記する。
* トップページ画面ID（例）: AXCMS-T-001（既存のトップ設計書がある場合はそちらのIDに合わせる）。
