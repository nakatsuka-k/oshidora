# スタッフ／キャスト評価 画面設計書

（出演キャスト・スタッフ評価）

---

## 画面名

* 画面ID: AXCMS-CR-001
* 画面名: スタッフキャスト評価
* 目的:
  動画作品に出演・参加したキャスト／スタッフに対して、星評価（5段階）とコメントを投稿できるようにする。
* 遷移元:

  * スタッフキャスト プロフィール（AXCMS-ST-001）
  * 動画詳細（AXCMS-V-002）内「キャスト評価」導線
* 遷移先:

  * 評価送信完了（同画面内状態遷移）
  * スタッフキャスト プロフィール（評価反映後）

---

## 画面概要

* 本画面は、特定のキャスト／スタッフ1名に対する評価を行う画面。
* 評価内容は以下で構成される。

  * 星評価（1〜5）
  * コメント（自由記述）
* 評価は **人物単位（cast_id）** で管理され、

  * 字幕あり／なし
  * 話数違い
    には影響されない。

---

## 評価ルール

* 評価は **1ユーザーにつき1キャスト1件**
* 再評価時は **上書き更新**
* 星評価は必須、コメントは任意
* 評価は即時反映（管理者承認なし）
  ※ 将来、承認制に切り替え可能な設計

---

## 画面構成

### 1) キャスト情報表示

* プロフィール画像
* 名前
* 役割（キャスト／スタッフ）

※ 誰への評価かを明確にするため、画面上部に固定表示

---

### 2) 星評価入力

* 星アイコン5つを横並び表示
* タップした星数が評価値となる
* 選択中の星はハイライト表示

---

### 3) コメント入力

* テキストエリア
* 複数行入力可能
* 入力例表示（プレースホルダー）

---

### 4) 送信・キャンセル

* 「評価を送信」
* 「キャンセル」

---

## 詳細テーブル

| 部品名称     | 部品の種類   | 型   | 桁数  | IN | OUT | 初期値  | 表示仕様      | DB情報備考 | テーブル名        | カラム名              |
| -------- | ------- | --- | --- | -- | --- | ---- | --------- | ------ | ------------ | ----------------- |
| 画面タイトル   | ラベル     | 文字列 | 20  |    | ○   | `評価` | 上部表示      | 固定文言   |              |                   |
| プロフィール画像 | 画像      | URL | -   |    | ○   | -    | 円形表示      | 表示用    | casts        | profile_image_url |
| 名前       | テキスト    | 文字列 | 50  |    | ○   | -    | 1行表示      | 表示用    | casts        | name              |
| 役割       | テキスト    | 文字列 | 20  |    | ○   | -    | キャスト/スタッフ | 表示用    | casts        | role              |
| 星評価      | レーティング  | 数値  | 1   | ○  |     | 未選択  | 1〜5       | 保存値    | cast_reviews | rating            |
| 星表示      | アイコン    | -   | -   |    | ○   | -    | 選択数だけ強調   | UI制御   |              |                   |
| コメント入力   | テキストエリア | 文字列 | 500 | ○  |     | 空文字  | 複数行       | 任意     | cast_reviews | comment           |
| 送信ボタン    | ボタン     | -   | -   | ○  |     | 非活性  | 星選択後に活性   | 保存     |              |                   |
| キャンセル    | ボタン     | -   | -   | ○  |     |      | 前画面へ戻る    | 遷移     |              |                   |
| 完了メッセージ  | テキスト    | 文字列 | 100 |    | ○   | 非表示  | 送信後表示     | 表示のみ   |              |                   |

---

## 挙動仕様

### 初期表示

* 対象キャスト情報を取得
* ユーザーが過去に評価済みの場合

  * 星評価・コメントを初期値として表示

---

### 評価入力

* 星をタップすると評価値がセットされる
* 星未選択の状態では送信ボタンは非活性
* コメントは未入力でも送信可能

---

### 評価送信

* 「評価を送信」タップ

  1. ローディング表示
  2. 評価登録API実行

     * 新規：INSERT
     * 既存あり：UPDATE
  3. 成功時

     * 完了メッセージ表示
     * プロフィール画面へ戻る or 自動遷移

---

### 失敗時

* エラーメッセージ表示
* 入力内容は保持
* 再送信可能

---

## エラー定義

| エラーNo     | 発生条件       | 表示内容         |
| --------- | ---------- | ------------ |
| CR-001-01 | キャスト情報取得失敗 | 情報の取得に失敗しました |
| CR-001-02 | 評価送信失敗     | 評価の送信に失敗しました |
| CR-001-03 | 通信エラー      | 通信エラーが発生しました |

---

## API仕様（画面連携）

### 評価取得

```
GET /api/casts/{castId}/review
```

### 評価送信

```
POST /api/casts/{castId}/review
```

```json
{
  "rating": 4,
  "comment": "演技がとても印象的でした"
}
```

---

## データ管理方針（参考）

* cast_reviews

  * id
  * cast_id
  * user_id
  * rating
  * comment
  * created_at
  * updated_at

* 集計値（平均・件数）は別途集計 or キャッシュ

---

## 備考

* 評価は作品横断で累積される
* 将来的な拡張

  * 評価コメントの通報
  * 管理者非表示対応
  * 評価履歴表示（マイページ）
