# 動画表示 画面設計書（確定版）

**フルサイズ再生／縦横自動切替／字幕切替／録画・キャプチャ防止対応**

---

## 画面名

* 画面ID: AXCMS-PL-001
* 画面名: 動画表示
* 目的:
  動画をフルサイズで再生し、動画の向き（縦／横）に応じて表示を自動切替する。
  字幕あり／なしを動画ファイル切替で制御し、評価・コメントは作品単位で統一管理する。
* 遷移元:

  * 動画詳細（AXCMS-V-002）
* 遷移先:

  * 動画詳細（戻る）
  * コメント記入／評価（オーバーレイ or 別画面）

---

## 前提・設計方針（重要）

* 動画再生時は **常に画面フルサイズ表示**
* 動画のメタ情報により **縦動画／横動画を自動判定**
* 字幕 ON / OFF は

  * **再生前に選択可能**
  * **再生中も切替可能（再生位置を引き継ぐ）**
* 字幕あり／なしは **別動画ファイル**
* 評価・コメントは **同一作品（content_id）で統一カウント**
* 録画防止・キャプチャ防止を可能な限り実装する

---

## 画面構成

### 1) 再生エリア（フルサイズ）

* 画面全体を動画表示に使用
* 端末向き・動画向きに応じて自動レイアウト

  * 横動画 → 横フルスクリーン
  * 縦動画 → 縦フルスクリーン
* 下部ナビゲーションは非表示

---

### 2) 再生前オプション（初回のみ表示）

**再生開始前に表示する選択UI**

* 字幕選択

  * `字幕なし（デフォルト）`
  * `字幕あり`
* 「再生する」ボタン

※ 一度選択した設定は、同作品内では保持しても良い（任意）

---

### 3) 再生中オーバーレイUI

* 一定時間操作がない場合は自動非表示
* タップで再表示

**表示要素**

* 再生／一時停止
* シークバー
* 字幕切替（字幕あり／なし）
* コメント／評価ボタン
* 戻るボタン

---

## コメント・評価の扱い（再生しながら行うか）

### フェーズ方針

* PH1: ❌ **再生しながらコメント・評価は対応しない**

  * 再生中のUIにはコメント／評価導線を出さない（または無効化）
  * コメント／評価は「動画詳細」など再生画面外の導線で行う
* PH2以降: ✅ 再生中のコメント／評価（オーバーレイ等）を検討・対応

---

## 字幕 ON / OFF 切替仕様（再生中）

### 基本仕様

* 字幕あり／なしは **別動画ファイル**
* 切替時は **再生位置を引き継ぐ**

### 切替フロー

1. 現在の再生位置（秒）を取得
2. 再生状態（再生／停止）を保持
3. 再生動画の playbackId を切替

   * 字幕なし → 字幕あり
   * 字幕あり → 字幕なし
4. 切替後、取得した再生位置へシーク
5. 元の再生状態を復元

### 注意点

* 2つの動画は **尺を揃える前提**
* 尺ズレがある場合

  * シーク失敗時は近似位置 or 先頭から再生

---

## 録画防止・キャプチャ防止

### 実装方針（可能な範囲）

#### モバイルアプリ（React Native想定）

* iOS

  * `isCaptured` 検知
  * 画面録画検知時に

    * 動画停止
    * 黒画面 or 警告表示

* Android

  * `FLAG_SECURE` を有効化
  * スクリーンショット／画面録画を防止

#### 共通

* バックグラウンド遷移時は自動停止
* マルチタスク切替時は再生停止

※ 完全防止は不可なため「抑止」を目的とする

---

## 評価・コメントの統一管理（重要）

### 管理単位

* 字幕あり／なしは **同一作品（content_id）**
* 評価・コメントは **動画ファイル単位では分けない**

### 表示・集計

* 動画詳細

  * 評価数／平均評価 → 統一表示
* コメント一覧

  * 作品単位で表示

### DBイメージ（参考）

* contents

  * id
  * title

* videos

  * id
  * content_id
  * playback_id_no_sub
  * playback_id_with_sub

* reviews

  * content_id
  * user_id
  * rating

* comments

  * content_id
  * user_id
  * body
  * status

---

## 挙動まとめ（要件反映チェック）

| 要件            | 対応           |
| ------------- | ------------ |
| フルサイズ再生       | 対応           |
| 縦横自動切替        | 対応           |
| 再生しながらコメント・評価 | PH1: 非対応 / PH2+: 対応予定 |
| 再生前に字幕選択      | 対応           |
| 再生中の字幕切替      | PH1: 対応（再生位置引き継ぎ） |
| 録画・キャプチャ防止    | 対応（抑止）       |
| 字幕別動画でも評価統一   | 対応（作品単位）     |

---

## 備考

* 字幕切替が「動画切替」であることはUI文言で明示する

  * 例：「字幕あり／なし（再生位置は維持されます）」
* コメント・評価を再生中に許可することで

  * UX向上
  * 離脱防止
    を狙う設計

