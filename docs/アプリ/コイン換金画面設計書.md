# コイン換金画面 設計書（PayPayポイント交換）

---

## 画面名

* 画面ID：APP-COIN-EXCHANGE-REQ-PP-001
* 画面名：コイン換金（PayPayポイント）
* 目的：
  キャスト／スタッフが保有コインを指定数、PayPayポイントとして交換申請する。
* 遷移元：

  * コイン換金先選択画面（APP-COIN-EXCHANGE-DEST-001）

    * PayPayポイント選択＋連携済み状態で「次へ」
* 遷移先：

  * コイン換金完了画面（APP-COIN-EXCHANGE-COMPLETE-001）
  * コイン換金先選択画面（戻る）
  * マイページ（キャンセル）

---

## 画面概要

* PayPayポイント交換に必要な入力・確認を行う申請画面
* 入力は「交換コイン数」を中心に最小化
* 交換は即時確定ではなく、申請 → 運営確認 → 反映（運用想定） 

---

## 表示条件

* キャスト／スタッフアカウントのみ
* 換金先として PayPay が選択され、連携済みであること

  * 未連携の場合は先選択画面へ戻す

---

## 画面構成

### ヘッダー

* 左：戻る
* 中央：`コイン換金`
* 右：なし

---

## セクション①：コイン状況

* **保有コイン**

  * 表示例：`現在の保有コイン：12,500コイン`
* **換金可能コイン**

  * 表示例：`換金可能：10,000コイン`
* **申請中コイン**

  * 表示例：`申請中：2,000コイン`
* 注意文言

  * `申請後、運営確認を行います`
  * `反映まで時間がかかる場合があります`

---

## セクション②：換金先（PayPay）

* **換金先**

  * 表示：`PayPayポイント`
* **連携状態**

  * 表示例：`連携済み`
* **連携アカウント（マスク表示）**

  * 表示例：`連携先：PayPay（********）`
* **連携変更**

  * リンク：`連携を変更する`
  * 押下で換金先選択画面へ戻る

---

## セクション③：交換内容入力

### 入力項目

1. **交換コイン数**

   * 数値入力
   * 入力補助

     * `全額（換金可能分）` ボタン
     * `1,000` / `3,000` / `5,000` のクイック選択（任意）

2. **交換レート**

   * 表示のみ
   * 例：`1コイン = 1ポイント（円相当）`
   * ※レートが変動する可能性がある場合は「当日レート」表記にする

3. **交換予定ポイント**

   * 自動計算表示
   * 例：`交換予定：5,000ポイント`

4. **手数料**

   * 表示のみ（運用に合わせて）
   * 例：`手数料：200円相当`
   * 例：`受取予定：4,800ポイント`

---

## セクション④：確認事項

* 文言例（チェックではなく注意表示でもOK）

  * `申請後の取り消しはできません`
  * `不正が確認された場合、申請を却下することがあります`
  * `反映は数営業日かかる場合があります`

---

## 操作エリア

* **交換申請する**

  * 押下条件

    * 交換コイン数が 1 以上
    * 交換コイン数 ≤ 換金可能コイン
    * PayPay連携が有効
  * 押下時

    * 確認ダイアログ表示

      * `◯◯コインをPayPayポイントへ交換申請しますか？`
    * OKで申請実行 → 完了画面へ

* **キャンセル**

  * マイページへ戻る
  * 入力途中でも戻れる

---

## 操作フロー

1. 換金先選択（PayPay連携済み）→ 本画面
2. 交換コイン数入力 → 交換予定ポイント自動表示
3. 交換申請 → 完了画面
4. 運営確認後、PayPayポイント反映（運用）

---

## 挙動仕様

* 申請送信中はボタン非活性＋ローディング表示
* エラー時は入力内容を保持し、再試行できるようにする
* 二重申請防止

  * 同一リクエストIDで冪等化
* 申請中が存在する場合

  * 追加申請を禁止するか、上限を設ける（どちらかに統一）

---

## 表示・保存データ

* ユーザーID
* 交換コイン数
* 交換予定ポイント
* 手数料（ある場合）
* 受取予定ポイント（ある場合）
* 換金先種別：PayPay
* 申請ステータス：申請中
* 申請日時

---

## 備考

* 機能一覧の「コイン交換：付与されたコインをPayPayポイントに交換」想定を反映 
* 交換確定は即時ではなく、運営確認を挟む運用を前提に文言を統一 
* 「換金可能コイン」の定義（投げ銭分のみ／売上確定分のみ等）は別途ルール化して管理側で算出する
