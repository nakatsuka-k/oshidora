# コイン換金先選択画面 設計書（PayPayポイント）

---

## 画面名

* 画面ID：APP-COIN-EXCHANGE-DEST-001
* 画面名：コイン換金先選択
* 目的：
  キャスト／スタッフが保有コインを換金（交換）する際、換金先を選択し、次の申請画面へ進む。
* 遷移元：

  * マイページ（APP-MYP-001）

    * 「コイン換金（キャストのみ）」押下
* 遷移先：

  * コイン換金画面（申請入力）（APP-COIN-EXCHANGE-REQ-001）
  * マイページ（キャンセル時）

---

## 画面概要

* キャスト／スタッフ向けの換金導線の最初の画面
* 現状の換金先は **PayPayポイント** を主対象として扱う
* ここでは「どこに交換するか」「連携が必要か」を決めるだけに絞る

---

## 表示条件

* キャスト／スタッフアカウントでログイン中の場合のみ表示
* 一般ユーザーはマイページに「コイン換金」を表示しない

---

## 画面構成

### ヘッダー

* 左：戻る
* 中央：`コイン換金`
* 右：なし

---

## セクション①：コイン状況

* **保有コイン**

  * 表示例：`現在の保有コイン：12,500コイン`
* **換金可能コイン**

  * 表示例：`換金可能：10,000コイン`
* 注意文言

  * `換金は申請後、運営の確認を行います`
  * `換金先の情報が未設定の場合、先に登録が必要です`

---

## セクション②：換金先（交換先）選択

### 表示形式

* リスト（ラジオボタン付き）
* 1つだけ選択可能

### 選択肢

1. **PayPayポイント**

   * 説明：`PayPayポイントへ交換します`
   * サブ情報：`交換後はPayPayアプリで利用できます`
   * ステータス表示（いずれか）

     * `未連携`：連携が必要
     * `連携済み`：次へ進める

2. （将来追加）**その他の交換先**

   * 現時点では非活性表示（「準備中」など）

※機能一覧に「付与されたコインをPayPayポイントに交換できる」想定があるため、初期はPayPay一本で問題ないです。 

---

## セクション③：PayPay連携（状態により表示）

### A. 未連携の場合

* 説明文：`PayPayポイントへ交換するため、PayPay連携が必要です`
* ボタン：`PayPayを連携する`

  * 押下で連携フロー（外部Web / OAuth相当）へ遷移
* 連携完了後

  * 本画面に戻り `連携済み` 表示

### B. 連携済みの場合

* 連携情報の一部を表示（マスク）

  * 例：`連携先：PayPay（********）`
* ボタン：`連携を解除`

  * 確認ダイアログ表示後に解除

---

## 操作エリア

* **次へ**

  * 押下条件

    * 換金先が「PayPayポイント」選択中
    * かつ PayPay連携が `連携済み`
  * 押下時

    * コイン換金画面（申請入力）へ遷移
    * 選択した換金先種別（PayPay）を引き継ぐ

* **キャンセル**

  * 押下時

    * マイページへ戻る

---

## 操作フロー

1. マイページ → コイン換金
2. 本画面で「PayPayポイント」を選択
3. 未連携なら「PayPayを連携する」→ 連携完了後に戻る
4. 「次へ」→ 換金申請画面へ

---

## 挙動仕様

* 保有コインが0の場合

  * 画面は表示できるが「次へ」は非活性
  * `換金可能なコインがありません` を表示
* 連携状態の取得に失敗した場合

  * エラーメッセージ表示
  * `再読み込み` ボタンを表示
* 二重申請防止

  * 申請中がある場合は、本画面または次画面でブロック（どちらかに統一）

---

## 表示・保存データ

* ユーザーID
* 保有コイン／換金可能コイン
* 換金先種別（PayPay）
* PayPay連携状態（未連携／連携済み）
* 連携識別子（表示はマスク）

---

## 備考

* 機能一覧にある「コイン交換：付与されたコインをPayPayポイントに交換できる」想定を採用 
* 交換タイミングは「申請後、管理画面で承認」想定だが、最終確定は別途（管理フロー）で詰める 
* PayPay連携の方式（OAuth/外部遷移/登録フォーム等）は別途技術選定に合わせて実装詳細を確定
