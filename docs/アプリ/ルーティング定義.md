# ルーティング定義（Web / Hash ルーティング）

一次情報: [apps/mobile/App.tsx](../../apps/mobile/App.tsx) の `screenToWebHash` / `webHashToScreen` / `shareUrlForWork` / `shareUrlForCast`。

## ベースURL

Web 版は Hash ルーティングを使用します。

- 本番想定: `https://oshidra.com/#/...`
- 実装上のベースURL決定: `resolveShareAppBaseUrl()`
  - `EXPO_PUBLIC_WEB_BASE_URL` があればそれを優先（末尾の `/` と `#...` は除去）
  - それ以外の Web 実行時は `window.location.origin + window.location.pathname`

## 画面（Screen）→ Hash

`screenToWebHash(screen)` の対応表です。

| Screen | Hash | 備考 |
| --- | --- | --- |
| `splash` | `#/splash` | |
| `home` | `#/home` | |
| `videoList` | `#/videos` | |
| `cast` | `#/cast` | |
| `castSearchResult` | `#/cast-result` | |
| `search` | `#/search` | |
| `work` | `#/work-search` | 作品検索 |
| `mypage` | `#/mypage` | |
| `castProfileRegister` | `#/cast-profile-register` | |
| `profileEdit` | `#/profile-edit` | |
| `profileRegister` | `#/profile-register` | |
| `welcome` | `#/welcome` | |
| `login` | `#/login` | |
| `tutorial` | `#/tutorial/1` | チュートリアルは可変（後述） |
| `terms` | `#/terms` | |
| `privacy` | `#/privacy` | |
| `purchase` | `#/purchase` | |
| `coinPurchase` | `#/coin-purchase` | |
| `coinGrant` | `#/coin-grant` | |
| `coinGrantComplete` | `#/coin-grant-complete` | |
| `coinExchangeDest` | `#/coin-exchange` | |
| `coinExchangePayPay` | `#/coin-exchange/paypay` | |
| `coinExchangeComplete` | `#/coin-exchange/complete` | |
| `comment` | `#/comment` | |
| `signup` | `#/signup` | |
| `emailVerify` | `#/email-verify` | |
| `sms2fa` | `#/sms-2fa` | |
| `registerComplete` | `#/register-complete` | |
| `phone` | `#/phone` | |
| `otp` | `#/otp` | |
| `ranking` | `#/ranking` | |
| `favorites` | `#/favorites` | |
| `favoriteVideos` | `#/favorites/videos` | |
| `favoriteCasts` | `#/favorites/casts` | |
| `favoriteCastsEdit` | `#/favorites/casts/edit` | |
| `watchHistory` | `#/watch-history` | |
| `settings` | `#/settings` | |
| `withdrawalRequest` | `#/withdrawal` | |
| `logout` | `#/logout` | |
| `notice` | `#/notice` | |
| `noticeDetail` | `#/notice-detail` | |
| `contact` | `#/contact` | |
| `faq` | `#/faq` | |
| `profile` | `#/profile` | 共有リンク（後述） |
| `castReview` | `#/cast-review` | |
| `workReview` | `#/work-review` | |
| `workDetail` | `#/work` | 共有リンク（後述） |
| `videoPlayer` | `#/play` | |
| `top` | `#/debug` | Debug 画面 |
| `dev` | `#/dev` | Developer メニュー |

## Hash → 画面（Screen）

`webHashToScreen(hash)` は次のルールです。

- `#/splash` または `#/` は `splash`
- `#/tutorial` / `#/tutorial/` は `tutorial`
- `#/tutorial/{n}`（例: `#/tutorial/2`）も `tutorial`
- クエリ（`?`）は画面判定では無視されます（`path = raw.split('?')[0]`）
- 上記以外の未知のパスは `WEB_DEFAULT_SCREEN`（`splash`）にフォールバックします

## チュートリアル（可変パス）

チュートリアルは `#/tutorial/{index}` 形式です。

- 生成: `tutorialIndexToWebHash(index)`
  - `index` は 0 始まり（0..2）で、URL 上は 1 始まり（1..3）
- 解析: `parseTutorialIndexFromWebHash(hash)`
  - `#/tutorial/2` → `index = 1`
  - 範囲外は 0..2 にクランプ

`TUTORIAL_SLIDE_COUNT = 3` のため、想定されるURLは次の通りです。

- `#/tutorial/1`
- `#/tutorial/2`
- `#/tutorial/3`

## 共有URL（Deep link）

### 作品共有

`shareUrlForWork(contentId, videoIdNoSub, title)` が生成するURL:

- 形式: `#/work?workId=...&title=...&thumb=...`
- 画面: `webHashToScreen()` 上は `workDetail`（`#/work`）

パラメータ:

- `workId`: 作品/コンテンツID（`contentId`）
- `title`: 作品タイトル
- `thumb`: OG 用のサムネ（Cloudflare Stream）
  - `https://videodelivery.net/{videoIdNoSub}/thumbnails/thumbnail.jpg?time=1s`

### キャスト共有

`shareUrlForCast(castId, castName)` が生成するURL:

- 形式: `#/profile?castId=...&title=...`
- 画面: `webHashToScreen()` 上は `profile`（`#/profile`）

パラメータ:

- `castId`: キャストID
- `title`: キャスト名
