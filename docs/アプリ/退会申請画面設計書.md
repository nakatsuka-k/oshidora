# 退会申請 画面設計書

（申請のみ。退会の実行は管理側承認後に別途実施）

---

## 画面名

- 画面ID: AXCMS-AC-003
- 画面名: 退会申請
- 目的:
  - ユーザーが退会希望を「申請」として送信できるようにする
  - 本画面の操作では **退会を実行しない**（アカウント削除・ログアウト・データ削除は行わない）
- 遷移元:
  - 設定（設定画面の「退会申請」）
- 遷移先:
  - 申請受付完了（同画面内状態遷移）
  - 設定（戻る）

---

## 画面概要

- ユーザーが退会希望を送信するための申請画面。
- 申請は D1 に **「退会申請リクエスト」** として保存し、管理画面で承認（許可）後に退会処理を実施する運用を想定。

---

## 入力・表示項目

| 部品名称 | 部品の種類 | 型 | 桁数 | IN | OUT | 初期値 | 表示仕様 | DB情報備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 画面タイトル | ラベル | 文字列 | - |  | ○ | `退会申請` | 上部表示 | 固定文言 |
| 注意文 | テキスト | 文字列 | - |  | ○ | - | 「申請しても退会は完了しない」旨を表示 | 表示のみ |
| メールアドレス | テキスト（表示のみ） | 文字列 | 200 | ○ | ○ | - | 連絡先メールとして表示（編集不可） | withdrawal_requests.email |
| 理由 | テキストエリア | 文字列 | 500 | ○ |  | 空文字 | 任意、複数行 | withdrawal_requests.reason |
| 送信ボタン | ボタン | - | - | ○ |  | 非活性 | 通信中は非活性 | 申請送信 |
| キャンセル | ボタン | - | - | ○ |  |  | 前画面へ戻る | 遷移 |
| 完了メッセージ | テキスト | 文字列 | - |  | ○ | 非表示 | 送信成功後に表示 | 表示のみ |

---

## 挙動仕様

### 初期表示

- メールアドレスはプロフィール情報（またはログイン/登録情報）から取得し表示する。

### 送信

- 「申請を送信」タップ
  1. ローディング表示
  2. 退会申請登録 API 実行
  3. 成功時
     - 完了メッセージ表示（同画面内）
     - 「戻る」で設定へ遷移

### 失敗時

- エラーメッセージ表示
- 入力内容（理由）は保持
- 再送信可能

---

## エラー定義

| エラーNo | 発生条件 | 表示内容 |
| --- | --- | --- |
| AC-003-01 | 未ログイン/認証失敗 | 申請に失敗しました（Unauthorized） |
| AC-003-02 | 入力不正 | 申請に失敗しました（入力内容をご確認ください） |
| AC-003-03 | 通信エラー | 申請に失敗しました（通信エラーが発生しました） |

---

## API仕様（画面連携）

### 退会申請登録

`POST /v1/withdrawal-requests`

Request:
```json
{
  "email": "user@example.com",
  "reason": "利用頻度が減ったため"
}
```

Response:
```json
{
  "ok": true,
  "id": "...",
  "status": "pending",
  "createdAt": "2026-01-10T00:00:00.000Z"
}
```

- 認証: `Authorization: Bearer <token>` 必須
- 本 API は退会処理を行わず、申請を保存するのみ

---

## DB（D1）

テーブル: `withdrawal_requests`

- `id` (TEXT, PK)
- `user_id` (TEXT)
- `email` (TEXT)
- `reason` (TEXT)
- `status` (TEXT) `pending` 固定（将来 `approved` / `rejected` などを想定）
- `created_at` (TEXT, ISO8601)

---

## 備考

- 管理画面での承認/却下、および退会実行（ユーザー無効化/削除）は本仕様の範囲外。
