# サブスク会員画面 設計書

---

## 画面名

* 画面ID：APP-SUBSCRIPTION-001
* 画面名：サブスク会員（加入/管理）
* 目的：
  サブスク加入により会員限定動画を視聴可能にし、加入状態の確認・管理（解約等）を提供する。
* 遷移元：

  * マイページ（加入状態の確認/管理）
  * 動画詳細 / 動画再生導線（会員限定エピソードを視聴しようとした場合）
* 遷移先：

  * Stripe Checkout（加入）
  * Stripe Customer Portal（管理/解約）
  * 元の画面へ復帰（加入状況更新後）

---

## 画面概要

* 本画面はアプリ内でサブスク加入状態を確認し、加入/管理のために Stripe の画面を起動する。
* 決済や解約手続きはアプリ内で完結させず、Stripe Checkout / Customer Portal を利用する。
* 加入状況はサーバー反映（Webhook）後にアプリが再取得して同期する。

---

## 画面構成

* 加入状態表示（未加入 / 加入中 / 解約予定 等）
* 「加入する」ボタン（未加入時）
* 「加入状況を更新」ボタン（任意）
* 「管理/解約する」ボタン（加入中）

---

## 挙動仕様

* 前提

  * ログイン必須（未ログインの場合はログイン導線へ）

* 加入状況の取得

  * 画面表示時および「加入状況を更新」押下時に `/v1/me` を呼び出し、加入状態を同期する。

* 加入（Stripe Checkout）

  * 「加入する」押下で加入用 Checkout セッションを作成し、返却された URL をブラウザで開く。
  * 決済完了後、Webhook によりサーバー側で加入状態を更新する。
  * アプリ側は復帰後に加入状況を再取得し、加入済みになったことを確認したら元の画面へ復帰する。

* 管理/解約（Customer Portal）

  * 「管理/解約する」押下で Customer Portal の URL を取得し、ブラウザで開く。
  * アプリ復帰後は加入状況を再取得し、表示に反映する。

---

## 備考

* 会員限定エピソードの視聴可否はサブスク加入状態により判定し、話数単位購入は行わない。
* コインは推しポイント付与にのみ使用し、視聴権限の購入には使用しない。
