name = "oshidra-api"
account_id = "c6270d2ac0aefb2ca6ce6831cbc9ca30"
main = "src/index.ts"
compatibility_date = "2026-01-02"
route = "https://api.oshidra.com/*"

[triggers]
# Every 5 minutes: execute scheduled publishing.
# Daily at 00:10 UTC: compute CMS rankings.
crons = ["*/5 * * * *", "10 0 * * *"]

[vars]
CLOUDFLARE_ACCOUNT_ID = "c6270d2ac0aefb2ca6ce6831cbc9ca30"
R2_BUCKET = "assets"
R2_PUBLIC_BASE_URL = "https://pub-a2d549876dd24a08aebc65d95ed4ff91.r2.dev"

# Stripe subscription (set secrets via `wrangler secret put STRIPE_SECRET_KEY` and `STRIPE_WEBHOOK_SECRET`)
STRIPE_SUBSCRIPTION_PRICE_ID = ""
STRIPE_CHECKOUT_SUCCESS_URL = "https://oshidra.com/subscription/success"
STRIPE_CHECKOUT_CANCEL_URL = "https://oshidra.com/subscription/cancel"
STRIPE_PORTAL_RETURN_URL = "https://oshidra.com/subscription"

[[r2_buckets]]
binding = "BUCKET"
bucket_name = "assets"

[[d1_databases]]
binding = "DB"
database_name = "oshidora-db"
database_id = "1f7de46f-7b0c-4150-ae76-6dd762a23f71"

# Production environment
[env.production]
name = "oshidra-api"
route = "https://api.oshidra.com/*"

[env.production.triggers]
crons = ["*/5 * * * *", "10 0 * * *"]

[env.production.vars]
CLOUDFLARE_ACCOUNT_ID = "c6270d2ac0aefb2ca6ce6831cbc9ca30"
R2_BUCKET = "assets"
R2_PUBLIC_BASE_URL = "https://pub-a2d549876dd24a08aebc65d95ed4ff91.r2.dev"

# Stripe subscription (set secrets via `wrangler secret put STRIPE_SECRET_KEY` and `STRIPE_WEBHOOK_SECRET`)
STRIPE_SUBSCRIPTION_PRICE_ID = ""
STRIPE_CHECKOUT_SUCCESS_URL = "https://oshidra.com/subscription/success"
STRIPE_CHECKOUT_CANCEL_URL = "https://oshidra.com/subscription/cancel"
STRIPE_PORTAL_RETURN_URL = "https://oshidra.com/subscription"

[[env.production.r2_buckets]]
binding = "BUCKET"
bucket_name = "assets"

[[env.production.d1_databases]]
binding = "DB"
database_name = "oshidora-db"
database_id = "1f7de46f-7b0c-4150-ae76-6dd762a23f71"
remote = true